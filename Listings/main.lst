C51 COMPILER V9.54   MAIN                                                                  05/25/2025 11:04:37 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg51.h>
   2          #include <INTRINS.H>
   3          
   4          #define multiplier 1.085
   5          
   6          // æ˜¾ç¤ºç›¸å…³å®šä¹‰
   7          #define DISP_PORT P2  // å…«ä½æ•°ç ç®¡è¿æ¥ç«¯å£
   8          
   9          // å¼•è„šå®šä¹‰
  10          sbit DATA = DISP_PORT^0;  // ä¸²è¡Œæ•°æ®è¾“å…¥
  11          sbit SCK  = DISP_PORT^1;  // ç§»ä½æ—¶é’Ÿ
  12          sbit RCK  = DISP_PORT^2;  // å­˜å‚¨æ—¶é’Ÿ
  13          sbit OE   = DISP_PORT^3;  // è¾“å‡ºä½¿èƒ½(ä½æœ‰æ•ˆ)
  14          
  15          /* å…±é˜´ææ•°ç ç®¡æ®µç å®šä¹‰ */
  16          #define SEG_OFF 0x00      // å­—æ®µå…¨ç­
  17          
  18          
  19          // æ›¿æ¢åŸæ¥çš„å­—ç¬¦æ˜ å°„è¡¨ä¸ºLEDæ•°ç»„å½¢å¼
  20          static code const unsigned char LED[] = {0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F};
  21          
  22          // æ›´æ–°æ˜¾ç¤ºç¼“å†²åŒºåˆå§‹åŒ–
  23          unsigned char dispbuff[8] = {SEG_OFF,SEG_OFF,SEG_OFF,SEG_OFF,SEG_OFF,SEG_OFF,SEG_OFF,SEG_OFF}; // æ˜¾ç¤ºç¼
             -“å†²åŒº
  24          
  25          // æ—¶é’Ÿå˜é‡
  26          unsigned char hour = 23, minute = 59, second = 55; // åˆå§‹æ—¶é—´
  27          unsigned int t0_count = 0; // 50msè®¡æ•°
  28          
  29          void delay_ms(unsigned int ms) {
  30   1          unsigned int i, j;
  31   1          for (i = 0; i < ms; i++)
  32   1              for (j = 0; j < 120; j++);
  33   1      }
  34          
  35          void SendTo595(unsigned char data_seg, unsigned char data_bit) {
  36   1          unsigned char i;
  37   1          OE = 1;
  38   1          
  39   1          for(i = 0; i < 8; i++) {
  40   2              DATA = (data_bit & 0x80) ? 1 : 0;
  41   2              SCK = 0; SCK = 1;
  42   2              data_bit <<= 1;
  43   2          }
  44   1          
  45   1          for(i = 0; i < 8; i++) {
  46   2              DATA = (data_seg & 0x80) ? 1 : 0;
  47   2              SCK = 0; SCK = 1;
  48   2              data_seg <<= 1;
  49   2          }
  50   1          
  51   1          RCK = 0; RCK = 1;
  52   1          OE = 0;
  53   1          delay_ms(1);
C51 COMPILER V9.54   MAIN                                                                  05/25/2025 11:04:37 PAGE 2   

  54   1      }
  55          
  56          void display_from_right(unsigned char target[]) {
  57   1          unsigned char i;
  58   1          static unsigned char mark = 0x01;
  59   1          
  60   1          for(i = 0; i < 8; i++) {
  61   2              SendTo595(target[i], ~(mark << i));
  62   2          }
  63   1          SendTo595(SEG_OFF, 0xFF);
  64   1          mark = 0x01;
  65   1      }
  66          
  67          void Resetdispbuff() {
  68   1          unsigned char i;
  69   1          for(i = 0; i < 8; i++) dispbuff[i] = SEG_OFF;
  70   1      }
  71          
  72          void FillTimeBuff() {
  73   1          Resetdispbuff();
  74   1          // ç§’éƒ¨åˆ†ï¼ˆå³èµ·0-1ä½ï¼‰
  75   1          dispbuff[0] = LED[second % 10]; // ç§’ä¸ªä½
  76   1          dispbuff[1] = LED[second / 10]; // ç§’åä½
  77   1          
  78   1          // åˆ†é’Ÿéƒ¨åˆ†ï¼ˆå³èµ·2-3ä½ï¼‰
  79   1          dispbuff[2] = LED[minute % 10];
  80   1          dispbuff[3] = LED[minute / 10];
  81   1          
  82   1          // å°æ—¶éƒ¨åˆ†ï¼ˆå³èµ·4-5ä½ï¼‰
  83   1          dispbuff[4] = LED[hour % 10];
  84   1          dispbuff[5] = LED[hour / 10];
  85   1      }
  86          
  87          void Timer0_Init() {
  88   1          TMOD &= 0xF0;     // æ¸…é™¤T0é…ç½®
  89   1          TMOD |= 0x01;     // å®šæ—¶å™¨0ï¼Œæ¨¡å¼1ï¼ˆ16ä½ï¼‰
  90   1          TH0 = 0x4B;       // 50msåˆå€¼
  91   1          TL0 = 0xFD;
  92   1          ET0 = 1;          // å…è®¸ä¸­æ–­
  93   1          TR0 = 1;          // å¯åŠ¨å®šæ—¶å™¨
  94   1      }
  95          
  96          void main(void) {
  97   1          EA = 1;           // å¼€å¯æ€»ä¸­æ–­
  98   1          Timer0_Init();     // åˆå§‹åŒ–å®šæ—¶å™¨
  99   1          P0 = 0xFF;
 100   1          
 101   1          while (1) {
 102   2              FillTimeBuff();          // æ›´æ–°æ—¶é—´æ˜¾ç¤ºç¼“å†²åŒº
 103   2              display_from_right(dispbuff); // åˆ·æ–°æ˜¾ç¤º
 104   2          }
 105   1      }
 106          
 107          // å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•°
 108          void Timer0_ISR() interrupt 1 {
 109   1          TH0 = 0x4B;       // é‡è£…åˆå€¼
 110   1          TL0 = 0xFD;
 111   1          t0_count++;
 112   1          
 113   1          if(t0_count >= 20) { // 1ç§’åˆ°
 114   2              t0_count = 0;
 115   2              second++;
C51 COMPILER V9.54   MAIN                                                                  05/25/2025 11:04:37 PAGE 3   

 116   2              
 117   2              if(second >= 60) {
 118   3                  second = 0;
 119   3                  minute++;
 120   3                  if(minute >= 60) {
 121   4                      minute = 0;
 122   4                      hour++;
 123   4                      if(hour >= 24) hour = 0;
 124   4                  }
 125   3              }
 126   2          }
 127   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    345    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
