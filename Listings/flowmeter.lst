C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE FLOWMETER
OBJECT MODULE PLACED IN .\Objects\flowmeter.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE flowmeter.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\f
                    -lowmeter.lst) OBJECT(.\Objects\flowmeter.obj)

line level    source

   1          #include "flowmeter.h"
   2          #include "intrins.h"
   3          #include "i2c.h"  // æ·»åŠ I2Cå¤´æ–‡ä»¶
   4          
   5          /*
   6           * ========================================
   7           * æµé‡è®¡ç³»ç»Ÿ - ç¡¬ä»¶è¿æ¥è¯´æ˜
   8           * ========================================
   9           * 
  10           * ã€å¼•è„šè¿æ¥å›¾ã€‘
  11           * ==============
  12           * 
  13           * 51å•ç‰‡æœº                   å¤–è®¾è¿æ¥
  14           * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  15           * â”‚                                                 â”‚
  16           * â”‚  P1.0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
  17           * â”‚                  â”‚                            â”‚
  18           * â”‚                  â”œâ”€â”€> ç»§ç”µå™¨å¸¸å¼€è§¦ç‚¹1          â”‚
  19           * â”‚                  â”‚                            â”‚
  20           * â”‚  P1.1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€> ç»§ç”µå™¨æ§åˆ¶çº¿(ä½ç”µå¹³å¸åˆ) â”‚
  21           * â”‚                  â”‚                            â”‚
  22           * â”‚  P3.2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€> ç»§ç”µå™¨å¸¸å¼€è§¦ç‚¹2          â”‚
  23           * â”‚  (INT0)                                        â”‚
  24           * â”‚                                                â”‚
  25           * â”‚  P2.0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> 24C02-SDA (æ•°æ®çº¿)   â”‚
  26           * â”‚  P2.1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> 24C02-SCL (æ—¶é’Ÿçº¿)   â”‚
  27           * â”‚                                                â”‚
  28           * â”‚  P2.3~P2.7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> æ•°ç ç®¡æ˜¾ç¤ºæ§åˆ¶         â”‚
  29           * â”‚                                                â”‚
  30           * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  31           * 
  32           * ã€å·¥ä½œåŸç†è¯´æ˜ã€‘
  33           * ================
  34           * 
  35           * 1. æ–¹æ³¢å‘ç”Ÿå™¨ (P1.0):
  36           *    - è¾“å‡º5Hzæ ‡å‡†æ–¹æ³¢ä¿¡å·
  37           *    - æ¯ä¸ªè„‰å†²ä»£è¡¨1æ¯«å‡æ°´æµ
  38           *    - è¿æ¥åˆ°ç»§ç”µå™¨å¸¸å¼€è§¦ç‚¹çš„ä¸€ç«¯
  39           * 
  40           * 2. ç»§ç”µå™¨æ§åˆ¶ (P1.1):
  41           *    - ä½ç”µå¹³(0)æ—¶ç»§ç”µå™¨å¸åˆï¼Œæ°´é˜€å¼€å¯
  42           *    - é«˜ç”µå¹³(1)æ—¶ç»§ç”µå™¨æ–­å¼€ï¼Œæ°´é˜€å…³é—­
  43           *    - å¸åˆæ—¶P1.0ä¿¡å·ä¼ å¯¼åˆ°P3.2
  44           * 
  45           * 3. æµé‡è®¡è¾“å…¥ (P3.2/INT0):
  46           *    - å¤–éƒ¨ä¸­æ–­0è¾“å…¥ï¼Œä¸‹é™æ²¿è§¦å‘
  47           *    - è¿æ¥åˆ°ç»§ç”µå™¨å¸¸å¼€è§¦ç‚¹çš„å¦ä¸€ç«¯
  48           *    - ç»§ç”µå™¨é—­åˆæ—¶æ¥æ”¶æ¥è‡ªP1.0çš„è„‰å†²
  49           * 
  50           * 4. 24C02å­˜å‚¨å™¨ (P2.0/P2.1):
  51           *    - P2.0: SDAæ•°æ®çº¿ï¼ŒåŒå‘é€šä¿¡
  52           *    - P2.1: SCLæ—¶é’Ÿçº¿ï¼Œæ§åˆ¶é€šä¿¡æ—¶åº
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 2   

  53           *    - å­˜å‚¨ç´¯è®¡æµé‡æ•°æ®ï¼Œæ‰ç”µä¸ä¸¢å¤±
  54           * 
  55           * ã€ä¿¡å·ä¼ è¾“è·¯å¾„ã€‘
  56           * ================
  57           * 
  58           * æ­£å¸¸å·¥ä½œæ—¶ï¼š
  59           * P1.0(5Hzæ–¹æ³¢) â†’ ç»§ç”µå™¨è§¦ç‚¹1 â†’ ç»§ç”µå™¨è§¦ç‚¹2 â†’ P3.2(INT0ä¸­æ–­)
  60           *                      â†‘
  61           *                 P1.1æ§åˆ¶çº¿(ä½ç”µå¹³å¸åˆ)
  62           * 
  63           * åœæ­¢å·¥ä½œæ—¶ï¼š
  64           * P1.0(5Hzæ–¹æ³¢) â†’ ç»§ç”µå™¨è§¦ç‚¹1   X   ç»§ç”µå™¨è§¦ç‚¹2 â†’ P3.2(æ— ä¿¡å·)
  65           *                      â†‘
  66           *                 P1.1æ§åˆ¶çº¿(é«˜ç”µå¹³æ–­å¼€)
  67           */
  68          
  69          /*
  70           * ========================================
  71           * æµé‡è®¡æ˜¾ç¤ºåŠŸèƒ½è¯¦ç»†è¯´æ˜
  72           * ========================================
  73           * 
  74           * ã€æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼ã€‘
  75           * ==================
  76           * 
  77           * æµ‡æ°´è¿‡ç¨‹ä¸­ï¼Œæ•°ç ç®¡ä¼šåœ¨ä¸¤ç§æ¨¡å¼é—´è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºï¼š
  78           * 
  79           * 1. å½“å‰æµé‡æ˜¾ç¤ºæ¨¡å¼ (FLOW_MODE_CURR)ï¼š
  80           *    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”
  81           *    â”‚ æ˜¾ç¤ºæ ¼å¼ï¼šXXXXX10                   â”‚
  82           *    â”‚ å«ä¹‰ï¼šå½“å‰ç¬æ—¶æµé‡ï¼Œå•ä½æ¯«å‡/ç§’      â”‚
  83           *    â”‚ ç¤ºä¾‹ï¼š"000510" = 5æ¯«å‡/ç§’           â”‚
  84           *    â”‚ å³ä¾§"10"æ ‡è¯†å½“å‰æµé‡æ¨¡å¼            â”‚
  85           *    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”˜
  86           * 
  87           * 2. ç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼ (FLOW_MODE_TOTAL)ï¼š
  88           *    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”
  89           *    â”‚ æ˜¾ç¤ºæ ¼å¼ï¼šXXXXX11                   â”‚
  90           *    â”‚ å«ä¹‰ï¼šç´¯è®¡æ€»æµé‡ï¼Œå•ä½æ¯«å‡           â”‚
  91           *    â”‚ ç¤ºä¾‹ï¼š"012311" = 123æ¯«å‡æ€»æµé‡      â”‚
  92           *    â”‚ å³ä¾§"11"æ ‡è¯†ç´¯è®¡æµé‡æ¨¡å¼            â”‚
  93           *    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”˜
  94           * 
  95           * ã€åˆ‡æ¢é¢‘ç‡ã€‘
  96           * ============
  97           * - æ¯3ç§’è‡ªåŠ¨åˆ‡æ¢ä¸€æ¬¡æ˜¾ç¤ºæ¨¡å¼
  98           * - æµ‡æ°´æœŸé—´æŒç»­è½®æµæ˜¾ç¤º
  99           * - åœæ­¢æµ‡æ°´åå…³é—­æµé‡æ˜¾ç¤º
 100           * 
 101           * ã€å®šæ—¶æµ‡æ°´æœŸé—´çš„æ˜¾ç¤ºã€‘
 102           * ======================
 103           * 
 104           * æ­£åœ¨æµ‡æ°´æ—¶ï¼š
 105           * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”
 106           * â”‚ æ˜¾ç¤ºï¼šå‰©ä½™æ¯«å‡æ•° "XXXX05"            â”‚
 107           * â”‚ ç¤ºä¾‹ï¼š"007505" = è¿˜éœ€æµ‡75æ¯«å‡       â”‚
 108           * â”‚ å®æ—¶å‡å°‘ï¼Œç›´åˆ°å˜ä¸º"000005"           â”‚
 109           * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 3   

             -”€â”€â”€â”€â”˜
 110           * 
 111           * ã€æµé‡è®¡ç®—åŸç†ã€‘
 112           * ================
 113           * 
 114           * è„‰å†²è®¡æ•°ï¼š
 115           * - INT0ä¸‹é™æ²¿è§¦å‘ä¸­æ–­
 116           * - æ¯ä¸ªä¸‹é™æ²¿ä»£è¡¨1æ¯«å‡æ°´æµ
 117           * - 5Hzé¢‘ç‡ = æ¯ç§’5ä¸ªè„‰å†² = 5æ¯«å‡/ç§’
 118           * 
 119           * ç´¯è®¡æµé‡ï¼š
 120           * - æ¯ç§’ç´¯åŠ å½“å‰æµé‡å€¼
 121           * - æ•°æ®æ¯10ç§’ä¿å­˜åˆ°24C02
 122           * - æ–­ç”µåä»24C02æ¢å¤æ•°æ®
 123           * 
 124           * ã€ä½¿ç”¨è¯´æ˜ã€‘
 125           * ============
 126           * 
 127           * æ‰‹åŠ¨æµ‡æ°´æ—¶æŸ¥çœ‹æµé‡ï¼š
 128           * 1. æŒ‰P3.3å¼€å§‹æ‰‹åŠ¨æµ‡æ°´
 129           * 2. è§‚å¯Ÿæ•°ç ç®¡æ˜¾ç¤ºçš„å½“å‰æµé‡å’Œç´¯è®¡æµé‡
 130           * 3. å†æŒ‰P3.3åœæ­¢æµ‡æ°´
 131           * 
 132           * å®šæ—¶æµ‡æ°´æ—¶æŸ¥çœ‹è¿›åº¦ï¼š
 133           * 1. è®¾ç½®å®šæ—¶æµ‡æ°´å¹¶å¯åŠ¨
 134           * 2. æµ‡æ°´å¼€å§‹æ—¶è§‚å¯Ÿå‰©ä½™æ¯«å‡æ•°
 135           * 3. æ•°å€¼é€æ¸å‡å°‘åˆ°0æ—¶è‡ªåŠ¨åœæ­¢
 136           */
 137          
 138          /*
 139           * æ•°ç ç®¡æ˜¾ç¤ºè¯´æ˜ï¼š
 140           * æµ‡æ°´è¿‡ç¨‹ä¸­æ•°ç ç®¡ä¼šè½®æµæ˜¾ç¤ºä¸¤ç§æ¨¡å¼ï¼šå½“å‰æµé‡å’Œç´¯è®¡æµé‡
 141           * 
 142           * 1. å½“å‰æµé‡æ˜¾ç¤ºæ¨¡å¼ï¼ˆFLOW_MODE_CURRï¼‰:
 143           *    - æ•°ç ç®¡ä»å³åˆ°å·¦ä¾æ¬¡ä¸ºï¼šä½1-ä½6
 144           *    - ä½1: ä¸æ˜¾ç¤º
 145           *    - ä½2: æ˜¾ç¤ºæ•°å­—"5"ï¼Œè¡¨ç¤ºå½“å‰ä¸ºæµé‡æ˜¾ç¤ºæ¨¡å¼
 146           *    - ä½3: ä¸æ˜¾ç¤º
 147           *    - ä½4-ä½6: æ˜¾ç¤ºå½“å‰æµé‡æ•°å€¼ï¼Œå•ä½ä¸ºæ¯«å‡/ç§’
 148           *      ä¾‹å¦‚ï¼šæ˜¾ç¤º"250 5 "è¡¨ç¤ºå½“å‰æµé‡ä¸º250æ¯«å‡/ç§’
 149           * 
 150           * 2. ç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼ï¼ˆFLOW_MODE_TOTALï¼‰:
 151           *    - æ•°ç ç®¡ä»å³åˆ°å·¦ä¾æ¬¡ä¸ºï¼šä½1-ä½6
 152           *    - ä½1: æ˜¾ç¤ºæ•°å­—"1"ï¼Œè¡¨ç¤ºå½“å‰ä¸ºç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼
 153           *    - ä½2-ä½6: æ˜¾ç¤ºç´¯è®¡æµé‡æ•°å€¼ï¼Œå•ä½ä¸ºæ¯«å‡
 154           *      ä¾‹å¦‚ï¼šæ˜¾ç¤º"23501"è¡¨ç¤ºç´¯è®¡æµé‡ä¸º2350æ¯«å‡
 155           * 
 156           * æ³¨ï¼šç³»ç»Ÿä¼šæ¯3ç§’åœ¨è¿™ä¸¤ç§æ˜¾ç¤ºæ¨¡å¼é—´è‡ªåŠ¨åˆ‡æ¢
 157           */
 158          
 159          // æµé‡è®¡å‚æ•°
 160          static BYTE flowMode = FLOW_MODE_OFF;     // æµé‡æ˜¾ç¤ºæ¨¡å¼
 161          static WORD pulseCount = 0;               // å½“å‰æµé‡è„‰å†²è®¡æ•°
 162          static WORD currentFlow = 0;              // å½“å‰æµé‡å€¼ï¼ˆæ¯«å‡/ç§’ï¼‰
 163          static unsigned long totalFlow = 0;       // ç´¯è®¡æµé‡å€¼ï¼ˆæ¯«å‡ï¼‰
 164          static bit isRunning = 0;                 // æµé‡è®¡è¿è¡ŒçŠ¶æ€
 165          static bit needUpdateDisplay = 0;         // æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
 166          static BYTE initialDisplayDelay = 0;      // åˆå§‹æ˜¾ç¤ºå»¶è¿Ÿè®¡æ•°å™¨
 167          
 168          // 24C02å­˜å‚¨æ§åˆ¶å˜é‡
 169          static BYTE saveCounter = 0;              // å®šæœŸä¿å­˜è®¡æ•°å™¨
 170          static bit totalFlowChanged = 0;          // ç´¯è®¡æµé‡å˜åŒ–æ ‡å¿—
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 4   

 171          static unsigned long lastSavedFlow = 0;   // ä¸Šæ¬¡ä¿å­˜çš„ç´¯è®¡æµé‡
 172          
 173          // æµé‡è®¡å‚æ•°å®šä¹‰
 174          #define PULSE_FACTOR 1                   // æ¯ä¸ªè„‰å†²ä»£è¡¨1æ¯«å‡
 175          #define FLOW_UPDATE_INTERVAL 1           // æ¯ç§’æ›´æ–°ä¸€æ¬¡æµé‡å€¼
 176          #define SAVE_INTERVAL 10                 // æ¯10ç§’ä¿å­˜ä¸€æ¬¡åˆ°24C02
 177          #define IMMEDIATE_SAVE_THRESHOLD 50      // ç´¯è®¡å·®å€¼è¶…è¿‡50mlç«‹å³ä¿å­˜
 178          
 179          // æµé‡è®¡åˆå§‹åŒ–
 180          void FlowMeter_Init(void) {
 181   1          /*
 182   1           * ç¡¬ä»¶åˆå§‹åŒ–è¯´æ˜ï¼š
 183   1           * - INT0 (P3.2): è®¾ç½®ä¸ºè¾¹æ²¿è§¦å‘ï¼Œæ£€æµ‹æµé‡è„‰å†²
 184   1           * - P1.0: æ–¹æ³¢å‘ç”Ÿå™¨è¾“å‡ºï¼Œæ¨¡æ‹Ÿæ°´æµä¼ æ„Ÿå™¨
 185   1           * - P1.1: ç»§ç”µå™¨æ§åˆ¶ï¼Œæ§åˆ¶æ°´é˜€å¼€å…³
 186   1           * - P2.0/P2.1: I2Cæ¥å£ï¼Œè¿æ¥24C02å­˜å‚¨èŠ¯ç‰‡
 187   1           */
 188   1          
 189   1          IT0 = 1;                           // è®¾ç½®INT0ä¸ºè¾¹æ²¿è§¦å‘ï¼ˆä¸‹é™æ²¿è§¦å‘ï¼‰
 190   1          EX0 = 1;                           // ä½¿èƒ½INT0ä¸­æ–­
 191   1          pulseCount = 0;                    // åˆå§‹åŒ–è„‰å†²è®¡æ•°
 192   1          currentFlow = 0;                   // åˆå§‹åŒ–å½“å‰æµé‡
 193   1          
 194   1          // ä»24C02è¯»å–ç´¯è®¡æµé‡æ•°æ®
 195   1          totalFlow = AT24C02_ReadTotalFlow();
 196   1          lastSavedFlow = totalFlow;         // è®°å½•åˆå§‹è¯»å–å€¼
 197   1          
 198   1          isRunning = 0;                     // åˆå§‹ä¸è¿è¡Œ
 199   1          flowMode = FLOW_MODE_OFF;          // é»˜è®¤æ˜¾ç¤ºæ¨¡å¼ä¸ºå…³é—­
 200   1          saveCounter = 0;                   // é‡ç½®ä¿å­˜è®¡æ•°å™¨
 201   1          totalFlowChanged = 0;              // é‡ç½®å˜åŒ–æ ‡å¿—
 202   1      }
 203          
 204          // å¯åŠ¨æµé‡è®¡
 205          void FlowMeter_Start(void) {
 206   1          if (!isRunning) {
 207   2              pulseCount = 0;                // é‡ç½®è„‰å†²è®¡æ•°
 208   2              EX0 = 1;                       // ä½¿èƒ½INT0ä¸­æ–­
 209   2              isRunning = 1;                 // æ ‡è®°æµé‡è®¡å¼€å§‹è¿è¡Œ
 210   2              
 211   2              // è®¾ç½®åˆå§‹éé›¶æµé‡å€¼
 212   2              currentFlow = 0; 
 213   2              
 214   2              // å¼ºåˆ¶ç«‹å³æ›´æ–°æ˜¾ç¤º
 215   2              needUpdateDisplay = 1;
 216   2              initialDisplayDelay = 2;       // è®¾ç½®åˆå§‹æ˜¾ç¤ºå»¶è¿Ÿ
 217   2          }
 218   1      }
 219          
 220          // åœæ­¢æµé‡è®¡
 221          void FlowMeter_Stop(void) {
 222   1          isRunning = 0;                     // æ ‡è®°æµé‡è®¡åœæ­¢
 223   1          // ä¸å…³é—­ä¸­æ–­ï¼Œä»¥ä¾¿ç»§ç»­ç»Ÿè®¡æ€»æµé‡
 224   1      }
 225          
 226          // å¤ä½æµé‡è®¡ç´¯è®¡å€¼
 227          void FlowMeter_Reset(void) {
 228   1          pulseCount = 0;                    // é‡ç½®è„‰å†²è®¡æ•°
 229   1          currentFlow = 0;                   // é‡ç½®å½“å‰æµé‡
 230   1          // æ³¨æ„ï¼šè¿™é‡Œä¸é‡ç½®totalFlowï¼Œå› ä¸ºç´¯è®¡æµé‡åº”è¯¥æ˜¯æ°¸ä¹…ç´¯è®¡çš„
 231   1          // å¦‚æœéœ€è¦é‡ç½®ç´¯è®¡æµé‡ï¼Œåº”è¯¥æä¾›å•ç‹¬çš„å‡½æ•°
 232   1      }
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 5   

 233          
 234          // æ–°å¢ï¼šé‡ç½®ç´¯è®¡æµé‡ï¼ˆåŒæ—¶æ¸…é™¤24C02ä¸­çš„æ•°æ®ï¼‰
 235          void FlowMeter_ResetTotal(void) {
 236   1          totalFlow = 0;
 237   1          AT24C02_WriteTotalFlow(0);
 238   1      }
 239          
 240          /*
 241           * ========================================
 242           * æµé‡è®¡æ˜¾ç¤ºåŠŸèƒ½è¯¦ç»†è¯´æ˜
 243           * ========================================
 244           * 
 245           * ã€æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼ã€‘
 246           * ==================
 247           * 
 248           * æµ‡æ°´è¿‡ç¨‹ä¸­ï¼Œæ•°ç ç®¡ä¼šåœ¨ä¸¤ç§æ¨¡å¼é—´è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºï¼š
 249           * 
 250           * 1. å½“å‰æµé‡æ˜¾ç¤ºæ¨¡å¼ (FLOW_MODE_CURR)ï¼š
 251           *    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”
 252           *    â”‚ æ˜¾ç¤ºæ ¼å¼ï¼šXXXXX10                   â”‚
 253           *    â”‚ å«ä¹‰ï¼šå½“å‰ç¬æ—¶æµé‡ï¼Œå•ä½æ¯«å‡/ç§’      â”‚
 254           *    â”‚ ç¤ºä¾‹ï¼š"000510" = 5æ¯«å‡/ç§’           â”‚
 255           *    â”‚ å³ä¾§"10"æ ‡è¯†å½“å‰æµé‡æ¨¡å¼            â”‚
 256           *    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”˜
 257           * 
 258           * 2. ç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼ (FLOW_MODE_TOTAL)ï¼š
 259           *    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”
 260           *    â”‚ æ˜¾ç¤ºæ ¼å¼ï¼šXXXXX11                   â”‚
 261           *    â”‚ å«ä¹‰ï¼šç´¯è®¡æ€»æµé‡ï¼Œå•ä½æ¯«å‡           â”‚
 262           *    â”‚ ç¤ºä¾‹ï¼š"012311" = 123æ¯«å‡æ€»æµé‡      â”‚
 263           *    â”‚ å³ä¾§"11"æ ‡è¯†ç´¯è®¡æµé‡æ¨¡å¼            â”‚
 264           *    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”€â”˜
 265           * 
 266           * ã€åˆ‡æ¢é¢‘ç‡ã€‘
 267           * ============
 268           * - æ¯3ç§’è‡ªåŠ¨åˆ‡æ¢ä¸€æ¬¡æ˜¾ç¤ºæ¨¡å¼
 269           * - æµ‡æ°´æœŸé—´æŒç»­è½®æµæ˜¾ç¤º
 270           * - åœæ­¢æµ‡æ°´åå…³é—­æµé‡æ˜¾ç¤º
 271           * 
 272           * ã€å®šæ—¶æµ‡æ°´æœŸé—´çš„æ˜¾ç¤ºã€‘
 273           * ======================
 274           * 
 275           * æ­£åœ¨æµ‡æ°´æ—¶ï¼š
 276           * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”
 277           * â”‚ æ˜¾ç¤ºï¼šå‰©ä½™æ¯«å‡æ•° "XXXX05"            â”‚
 278           * â”‚ ç¤ºä¾‹ï¼š"007505" = è¿˜éœ€æµ‡75æ¯«å‡       â”‚
 279           * â”‚ å®æ—¶å‡å°‘ï¼Œç›´åˆ°å˜ä¸º"000005"           â”‚
 280           * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â
             -”€â”€â”€â”€â”˜
 281           * 
 282           * ã€æµé‡è®¡ç®—åŸç†ã€‘
 283           * ================
 284           * 
 285           * è„‰å†²è®¡æ•°ï¼š
 286           * - INT0ä¸‹é™æ²¿è§¦å‘ä¸­æ–­
 287           * - æ¯ä¸ªä¸‹é™æ²¿ä»£è¡¨1æ¯«å‡æ°´æµ
 288           * - 5Hzé¢‘ç‡ = æ¯ç§’5ä¸ªè„‰å†² = 5æ¯«å‡/ç§’
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 6   

 289           * 
 290           * ç´¯è®¡æµé‡ï¼š
 291           * - æ¯ç§’ç´¯åŠ å½“å‰æµé‡å€¼
 292           * - æ•°æ®æ¯10ç§’ä¿å­˜åˆ°24C02
 293           * - æ–­ç”µåä»24C02æ¢å¤æ•°æ®
 294           * 
 295           * ã€ä½¿ç”¨è¯´æ˜ã€‘
 296           * ============
 297           * 
 298           * æ‰‹åŠ¨æµ‡æ°´æ—¶æŸ¥çœ‹æµé‡ï¼š
 299           * 1. æŒ‰P3.3å¼€å§‹æ‰‹åŠ¨æµ‡æ°´
 300           * 2. è§‚å¯Ÿæ•°ç ç®¡æ˜¾ç¤ºçš„å½“å‰æµé‡å’Œç´¯è®¡æµé‡
 301           * 3. å†æŒ‰P3.3åœæ­¢æµ‡æ°´
 302           * 
 303           * å®šæ—¶æµ‡æ°´æ—¶æŸ¥çœ‹è¿›åº¦ï¼š
 304           * 1. è®¾ç½®å®šæ—¶æµ‡æ°´å¹¶å¯åŠ¨
 305           * 2. æµ‡æ°´å¼€å§‹æ—¶è§‚å¯Ÿå‰©ä½™æ¯«å‡æ•°
 306           * 3. æ•°å€¼é€æ¸å‡å°‘åˆ°0æ—¶è‡ªåŠ¨åœæ­¢
 307           */
 308          
 309          /*
 310           * æ•°ç ç®¡æ˜¾ç¤ºè¯´æ˜ï¼š
 311           * æµ‡æ°´è¿‡ç¨‹ä¸­æ•°ç ç®¡ä¼šè½®æµæ˜¾ç¤ºä¸¤ç§æ¨¡å¼ï¼šå½“å‰æµé‡å’Œç´¯è®¡æµé‡
 312           * 
 313           * 1. å½“å‰æµé‡æ˜¾ç¤ºæ¨¡å¼ï¼ˆFLOW_MODE_CURRï¼‰:
 314           *    - æ•°ç ç®¡ä»å³åˆ°å·¦ä¾æ¬¡ä¸ºï¼šä½1-ä½6
 315           *    - ä½1: ä¸æ˜¾ç¤º
 316           *    - ä½2: æ˜¾ç¤ºæ•°å­—"5"ï¼Œè¡¨ç¤ºå½“å‰ä¸ºæµé‡æ˜¾ç¤ºæ¨¡å¼
 317           *    - ä½3: ä¸æ˜¾ç¤º
 318           *    - ä½4-ä½6: æ˜¾ç¤ºå½“å‰æµé‡æ•°å€¼ï¼Œå•ä½ä¸ºæ¯«å‡/ç§’
 319           *      ä¾‹å¦‚ï¼šæ˜¾ç¤º"250 5 "è¡¨ç¤ºå½“å‰æµé‡ä¸º250æ¯«å‡/ç§’
 320           * 
 321           * 2. ç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼ï¼ˆFLOW_MODE_TOTALï¼‰:
 322           *    - æ•°ç ç®¡ä»å³åˆ°å·¦ä¾æ¬¡ä¸ºï¼šä½1-ä½6
 323           *    - ä½1: æ˜¾ç¤ºæ•°å­—"1"ï¼Œè¡¨ç¤ºå½“å‰ä¸ºç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼
 324           *    - ä½2-ä½6: æ˜¾ç¤ºç´¯è®¡æµé‡æ•°å€¼ï¼Œå•ä½ä¸ºæ¯«å‡
 325           *      ä¾‹å¦‚ï¼šæ˜¾ç¤º"23501"è¡¨ç¤ºç´¯è®¡æµé‡ä¸º2350æ¯«å‡
 326           * 
 327           * æ³¨ï¼šç³»ç»Ÿä¼šæ¯3ç§’åœ¨è¿™ä¸¤ç§æ˜¾ç¤ºæ¨¡å¼é—´è‡ªåŠ¨åˆ‡æ¢
 328           */
 329          
 330          // è®¡ç®—æµé‡ï¼ˆæ¯ç§’è°ƒç”¨ä¸€æ¬¡ï¼Œç”±ä¸­æ–­è§¦å‘ï¼‰
 331          void FlowMeter_CalcFlow(void) {
 332   1          static BYTE updateCounter = 0;
 333   1          
 334   1          if (initialDisplayDelay > 0) {
 335   2              initialDisplayDelay--;
 336   2              if (initialDisplayDelay == 0) {
 337   3                  needUpdateDisplay = 1;
 338   3              }
 339   2          }
 340   1          
 341   1          // æ¯FLOW_UPDATE_INTERVALç§’æ›´æ–°ä¸€æ¬¡å½“å‰æµé‡
 342   1          if (++updateCounter >= FLOW_UPDATE_INTERVAL) {
 343   2              updateCounter = 0;
 344   2              
 345   2              if (isRunning) {
 346   3                  currentFlow = pulseCount;
 347   3                  
 348   3                  // æ›´æ–°ç´¯è®¡æµé‡ï¼ˆæ¯«å‡ï¼‰
 349   3                  if (currentFlow > 0) {
 350   4                      unsigned long oldTotalFlow = totalFlow;
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 7   

 351   4                      totalFlow += currentFlow;
 352   4                      
 353   4                      // æ ‡è®°ç´¯è®¡æµé‡å·²æ”¹å˜
 354   4                      if (totalFlow != oldTotalFlow) {
 355   5                          totalFlowChanged = 1;
 356   5                      }
 357   4                      
 358   4                      // æ£€æŸ¥æ˜¯å¦éœ€è¦ç«‹å³ä¿å­˜ï¼ˆé˜²æ­¢å¤§é‡æ•°æ®ä¸¢å¤±ï¼‰
 359   4                      if (totalFlow - lastSavedFlow >= IMMEDIATE_SAVE_THRESHOLD) {
 360   5                          SaveTotalFlowToEEPROM();
 361   5                      }
 362   4                  }
 363   3              }
 364   2              
 365   2              // å®šæœŸä¿å­˜ç´¯è®¡æµé‡åˆ°24C02
 366   2              if (++saveCounter >= SAVE_INTERVAL) {
 367   3                  saveCounter = 0;
 368   3                  
 369   3                  // åªæœ‰å½“ç´¯è®¡æµé‡å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¿å­˜
 370   3                  if (totalFlowChanged) {
 371   4                      SaveTotalFlowToEEPROM();
 372   4                  }
 373   3              }
 374   2              
 375   2              // é‡ç½®è„‰å†²è®¡æ•°ï¼Œå‡†å¤‡ä¸‹æ¬¡ç»Ÿè®¡
 376   2              pulseCount = 0;
 377   2              needUpdateDisplay = 1;
 378   2          }
 379   1          
 380   1          // è½®æµæ˜¾ç¤ºåˆ‡æ¢é€»è¾‘
 381   1          if (isRunning) {
 382   2              static BYTE displayToggle = 0;
 383   2              
 384   2              if (++displayToggle >= 3) {  
 385   3                  displayToggle = 0;
 386   3                  flowMode = (flowMode == FLOW_MODE_CURR) ? FLOW_MODE_TOTAL : FLOW_MODE_CURR;
 387   3                  needUpdateDisplay = 1;
 388   3              }
 389   2          }
 390   1      }
 391          
 392          /*
 393           * ========================================
 394           * 24C02ç´¯è®¡æµé‡å­˜å‚¨åŠŸèƒ½
 395           * ========================================
 396           * 
 397           * ã€å­˜å‚¨ç­–ç•¥ã€‘
 398           * ============
 399           * 1. å®šæœŸä¿å­˜ï¼šæ¯10ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡ç´¯è®¡æµé‡
 400           * 2. å³æ—¶ä¿å­˜ï¼šç´¯è®¡æµé‡å¢åŠ è¶…è¿‡50mlæ—¶ç«‹å³ä¿å­˜
 401           * 3. æ™ºèƒ½ä¿å­˜ï¼šåªæœ‰æ•°æ®å˜åŒ–æ—¶æ‰æ‰§è¡Œå†™å…¥æ“ä½œ
 402           * 4. æ‰ç”µä¿æŠ¤ï¼šæ–­ç”µé‡å¯åè‡ªåŠ¨æ¢å¤ç´¯è®¡æµé‡æ•°æ®
 403           * 
 404           * ã€24C02åœ°å€åˆ†é…ã€‘
 405           * ==================
 406           * åœ°å€0x00-0x03: ç´¯è®¡æµé‡æ•°æ® (4å­—èŠ‚unsigned long)
 407           * åœ°å€0x10-0x16: å®šæ—¶æµ‡æ°´å‚æ•° (7å­—èŠ‚)
 408           * 
 409           * ã€æ•°æ®æ ¼å¼ã€‘
 410           * ============
 411           * ç´¯è®¡æµé‡æŒ‰å°ç«¯åºå­˜å‚¨ï¼š
 412           * - 0x00: ç´¯è®¡æµé‡ä½å­—èŠ‚  (totalFlow & 0xFF)
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 8   

 413           * - 0x01: ç´¯è®¡æµé‡ç¬¬2å­—èŠ‚ ((totalFlow >> 8) & 0xFF)  
 414           * - 0x02: ç´¯è®¡æµé‡ç¬¬3å­—èŠ‚ ((totalFlow >> 16) & 0xFF)
 415           * - 0x03: ç´¯è®¡æµé‡é«˜å­—èŠ‚  ((totalFlow >> 24) & 0xFF)
 416           */
 417          
 418          // ä¿å­˜ç´¯è®¡æµé‡åˆ°24C02
 419          void SaveTotalFlowToEEPROM(void) {
 420   1          // å†™å…¥4å­—èŠ‚ç´¯è®¡æµé‡æ•°æ®åˆ°24C02
 421   1          AT24C02_WriteTotalFlow(totalFlow);
 422   1          
 423   1          // æ›´æ–°ä¿å­˜çŠ¶æ€
 424   1          lastSavedFlow = totalFlow;
 425   1          totalFlowChanged = 0;
 426   1          
 427   1          // é€šè¿‡ä¸²å£è¾“å‡ºä¿å­˜ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼Œå¯é€‰ï¼‰
 428   1          #ifdef DEBUG_FLOW_SAVE
                  UART_SendString("ç´¯è®¡æµé‡å·²ä¿å­˜: ");
                  // è¿™é‡Œå¯ä»¥æ·»åŠ æ•°å€¼è½¬æ¢å’Œè¾“å‡ºä»£ç 
                  UART_SendString("æ¯«å‡\r\n");
                  #endif
 433   1      }
 434          
 435          // ä»24C02è¯»å–ç´¯è®¡æµé‡
 436          unsigned long LoadTotalFlowFromEEPROM(void) {
 437   1          unsigned long loadedFlow = AT24C02_ReadTotalFlow();
 438   1          
 439   1          // æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥ï¼ˆé˜²æ­¢è¯»å–åˆ°æ— æ•ˆæ•°æ®ï¼‰
 440   1          if (loadedFlow > 999999) {  // å¦‚æœç´¯è®¡æµé‡è¶…è¿‡999å‡ï¼Œè®¤ä¸ºæ•°æ®å¼‚å¸¸
 441   2              loadedFlow = 0;         // é‡ç½®ä¸º0
 442   2              AT24C02_WriteTotalFlow(0); // æ¸…é›¶24C02ä¸­çš„æ•°æ®
 443   2          }
 444   1          
 445   1          return loadedFlow;
 446   1      }
 447          
 448          // å¼ºåˆ¶ä¿å­˜å½“å‰ç´¯è®¡æµé‡ï¼ˆå¤–éƒ¨è°ƒç”¨ï¼‰
 449          void FlowMeter_ForceSave(void) {
 450   1          SaveTotalFlowToEEPROM();
 451   1      }
 452          
 453          // è·å–ä¸Šæ¬¡ä¿å­˜æ—¶é—´ç‚¹çš„ç´¯è®¡æµé‡
 454          unsigned long FlowMeter_GetLastSavedFlow(void) {
 455   1          return lastSavedFlow;
 456   1      }
 457          
 458          // æ£€æŸ¥ç´¯è®¡æµé‡æ˜¯å¦æœ‰æœªä¿å­˜çš„å˜åŒ–
 459          bit FlowMeter_HasUnsavedChanges(void) {
 460   1          return totalFlowChanged;
 461   1      }
 462          
 463          // æ£€æŸ¥å¹¶æ›´æ–°æ˜¾ç¤ºï¼ˆåœ¨ä¸»å¾ªç¯ä¸­è°ƒç”¨ï¼Œä¸åœ¨ä¸­æ–­ä¸­ï¼‰
 464          void FlowMeter_UpdateDisplay(void) {
 465   1          if (needUpdateDisplay) {
 466   2              needUpdateDisplay = 0;  // æ¸…é™¤æ ‡å¿—
 467   2              
 468   2              // æ ¹æ®å½“å‰æ¨¡å¼æ›´æ–°æ˜¾ç¤º
 469   2              if (flowMode == FLOW_MODE_CURR) {
 470   3                  UpdateCurrentFlowDisplay();
 471   3              } else if (flowMode == FLOW_MODE_TOTAL) {
 472   3                  UpdateTotalFlowDisplay();
 473   3              }
 474   2          }
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 9   

 475   1      }
 476          
 477          // æ›´æ–°å½“å‰æµé‡æ˜¾ç¤º
 478          void UpdateCurrentFlowDisplay(void) {
 479   1          BYTE val1, val2, val3, val4, val5, val6;
 480   1          
 481   1          // æå–å½“å‰æµé‡å„ä½æ•°å­—ï¼ˆæ¯«å‡/ç§’ï¼‰
 482   1          WORD flow_display = currentFlow;  // currentFlowå·²ç»æ˜¯æ¯«å‡/ç§’çš„å€¼
 483   1          
 484   1          // æ„é€ æ˜¾ç¤ºæ•°å­— - æ ¼å¼ï¼šXXXXæ¯«å‡/ç§’
 485   1          val1 = 10;  // 10ï¼Œè¡¨ç¤ºå½“å‰æµé‡æ˜¾ç¤ºæ¨¡å¼
 486   1          val2 = (flow_display / 10000) % 10; // ä¸‡ä½ï¼ˆæ¯«å‡/ç§’ï¼‰
 487   1          val3 = (flow_display / 1000) % 10;  // åƒä½ï¼ˆæ¯«å‡/ç§’ï¼‰
 488   1          val4 = (flow_display / 100) % 10;   // ç™¾ä½ï¼ˆæ¯«å‡/ç§’ï¼‰
 489   1          val5 = (flow_display / 10) % 10;    // åä½ï¼ˆæ¯«å‡/ç§’ï¼‰
 490   1          val6 = flow_display % 10;           // ä¸ªä½ï¼ˆæ¯«å‡/ç§’ï¼‰
 491   1          
 492   1          // ç›´æ¥å¡«å……æ˜¾ç¤ºç¼“å†²åŒº - æ˜¾ç¤ºæ ¼å¼å¦‚ï¼š250æ¯«å‡/ç§’æ˜¾ç¤ºä¸º"25010"
 493   1          FillCustomDispBuf(val6, val5, val4, val3, val2, val1);
 494   1      }
 495          
 496          // æ›´æ–°ç´¯è®¡æµé‡æ˜¾ç¤º
 497          void UpdateTotalFlowDisplay(void) {
 498   1          BYTE val1, val2, val3, val4, val5, val6;
 499   1          
 500   1          // æå–æ€»æµé‡å„ä½æ•°å­—ï¼ˆæ¯«å‡ï¼‰
 501   1          unsigned long flow_ml = totalFlow;  // ç›´æ¥ä½¿ç”¨æ¯«å‡å€¼
 502   1          
 503   1          // æ„é€ æ˜¾ç¤ºæ•°å­—
 504   1          val1 = 11;  // 11,ç´¯è®¡æµé‡æ˜¾ç¤ºæ¨¡å¼
 505   1          val2 = (BYTE)((flow_ml / 10000) % 10); // ä¸‡ä½ï¼ˆæ¯«å‡ï¼‰
 506   1          val3 = (BYTE)((flow_ml / 1000) % 10);  // åƒä½ï¼ˆæ¯«å‡ï¼‰
 507   1          val4 = (BYTE)((flow_ml / 100) % 10);   // ç™¾ä½ï¼ˆæ¯«å‡ï¼‰
 508   1          val5 = (BYTE)((flow_ml / 10) % 10);    // åä½ï¼ˆæ¯«å‡ï¼‰
 509   1          val6 = (BYTE)(flow_ml % 10);           // ä¸ªä½ï¼ˆæ¯«å‡ï¼‰
 510   1          
 511   1          // ç›´æ¥å¡«å……æ˜¾ç¤ºç¼“å†²åŒº
 512   1          FillCustomDispBuf(val6, val5, val4, val3, val2, val1);
 513   1      }
 514          
 515          // æ˜¾ç¤ºå½“å‰æµé‡ï¼ˆè¿™ä¸ªå‡½æ•°ä»…ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œä¸åœ¨å†…éƒ¨è°ƒç”¨é“¾ä¸­ä½¿ç”¨ï¼‰
 516          void FlowMeter_DisplayCurrent(void) {
 517   1          UpdateCurrentFlowDisplay();
 518   1      }
 519          
 520          // æ˜¾ç¤ºç´¯è®¡æµé‡ï¼ˆè¿™ä¸ªå‡½æ•°ä»…ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œä¸åœ¨å†…éƒ¨è°ƒç”¨é“¾ä¸­ä½¿ç”¨ï¼‰
 521          void FlowMeter_DisplayTotal(void) {
 522   1          UpdateTotalFlowDisplay();
 523   1      }
 524          
 525          // è®¾ç½®æµé‡æ˜¾ç¤ºæ¨¡å¼
 526          void FlowMeter_SetMode(BYTE mode) {
 527   1          flowMode = mode;
 528   1          
 529   1          // ä»…è®¾ç½®æ›´æ–°æ ‡å¿—ï¼Œå®é™…æ˜¾ç¤ºåœ¨ä¸»å¾ªç¯ä¸­æ‰§è¡Œ
 530   1          needUpdateDisplay = 1;
 531   1      }
 532          
 533          // è·å–å½“å‰æµé‡æ˜¾ç¤ºæ¨¡å¼
 534          BYTE FlowMeter_GetMode(void) {
 535   1          return flowMode;
 536   1      }
C51 COMPILER V9.54   FLOWMETER                                                             05/27/2025 12:57:11 PAGE 10  

 537          
 538          // è·å–å½“å‰æµé‡
 539          WORD FlowMeter_GetCurrentFlow(void) {
 540   1          // è¿”å›å®é™…çš„æ¯«å‡/ç§’å€¼ï¼Œç”¨äºå®šæ—¶æµ‡æ°´è®¡ç®—
 541   1          return currentFlow;  // ç›´æ¥è¿”å›æ¯«å‡/ç§’å€¼
 542   1      }
 543          
 544          // è·å–ç´¯è®¡æµé‡
 545          unsigned long FlowMeter_GetTotalFlow(void) {
 546   1          return totalFlow;
 547   1      }
 548          
 549          // å¤–éƒ¨ä¸­æ–­0æœåŠ¡å‡½æ•° - ç”¨äºè„‰å†²è®¡æ•°
 550          void INT0_ISR() interrupt 0 {
 551   1          // ç®€å•è®¡æ•°ï¼Œæ¯æ¬¡ä¸‹é™æ²¿ä¸­æ–­å¢åŠ è®¡æ•°
 552   1          // å¦‚æœè¿™é‡Œè¢«è°ƒç”¨å¤ªé¢‘ç¹ï¼Œå¯èƒ½æ˜¯ï¼š
 553   1          // 1. T0é¢‘ç‡è¿‡é«˜
 554   1          // 2. ç»§ç”µå™¨è§¦ç‚¹æŠ–åŠ¨
 555   1          // 3. ä¿¡å·å™ªå£°
 556   1          pulseCount++;  // æ¯æ¬¡ä¸­æ–­å¢åŠ è„‰å†²è®¡æ•°
 557   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    742    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17      22
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
